## 协议（protocol）
一组相关的协议的集合称为协议组
指定协议组中的各种协议如何进行关联并且划分需要完成的任务的设计，称为协议组的体系结构或参考模型
TCP/IP是一个实现了Internet架构的协议组，它起源于ARPANET Reference Model

值得一提的是TCP/IP架构是从一个为了解决提供不同的分组交换计算机网络之间的连接的工作进化而来。它通过在相互不兼容的网络之间使用带有翻译功能的网关（路由器）完成

TCP/IP组成了全球互联网的基础。

一些目标引导了Internet结构的出现，主要的是开发一种有效的可以重复利用现有的已经连接的网络的技术

分组交换

在分组交换中，包含一定字节数的数字信息“块”（分组）独立在网络中传输。
不同来源以及不同客户端的块被混合到一起，后续又被拆分开来，这被称为“多路”复用

在到达目的地的路径中，块可以从一个交换机（switch）移动到另一个交换机，而且路径也是可以被改变的。这样就带来了两个好处，网络更具备弹性（设计者不用担心网络受到物理攻击）；基于统计复用可以更好的利用网络连接和交换设备

当交换机接收到了包，通常将保存在缓冲内存（缓存）或者队列中，并按照**FIFS（first-come-first-served）**，也称为FIFO
FIFO缓存管理以及按需调度可以简单的组合起来实现统计复用，这是一种用于混合来自Internet上不同来源的流量的主要方法，在统计复用中，流量基于到达的统计和时间模式混合在一起
缺点是这种方式缺少可预测性，任何特定的应用程序的性能都取决于共享网络中的其他应用的统计信息
统计复用就像是一条高速公路，车辆可以变换车道，但是最终会分散在各处，任何点的收缩都可能造成道路繁忙。

这就好比路上的车也可以排队往前开 但是也可以插队，这样就很容易造成交通阻塞，并且缺乏可预测性

time-division multiplexing（TDM）分时复用、static multiplexing（静态多路复用）作为统计复用的替代技术，在每次连接时通常会保留一段时间或者资源，这就造成了尽管这些技术提供了更多的可预测性，但是网络流量却没有被完全利用，因为保留的带宽没有被使用。

尽管线路可以直接通过分时复用直接实现， 虚拟的电路（VC）表现出许多电路行为但不依赖于电路物理电路交换机可以在面向连接（connection-oriented）的分组上实现。这是X.25协议的基础。

虚拟电路以及面向连接分组网络（比如X.25）需要为每个连接在交换机中保存一些信息或状态，这是因为每个包仅仅携带了一部分提供状态表索引的额外信息。在X.25中每个交换机中都存在logical channel identifier (LCI) or logical channel number (LCN)，两者跟per-flow state一起确定路径上下一个交换机，而pre-flow state是早数据交换之前通过（signaling protocol）信令协议创建的，这样的网络称为面向连接的。



datagram（数据报），这是一个特殊的包，资源的标识信息以及最终目标都保存在包内部，而不是在交换机上。虽然这样需要更大的数据包，不再需要分组交换机上的连接状态，并且可以构建无连接网络，消除了对（复杂的）信令协议的需求。

消息边界或记录标记：当写入端输入多个数据块时，协议是否会保留每个块之前的边界。如果保留，则接收端可以原封不动的拿到写入的消息（数据报是因为自身记住了开始跟结束，所以肯定支持消息边界），如果协议没有保留，接收端则需要自己实现。

例子：

写入端写入（AAA BBB CCC），协议保留消息边界，则接收端获取的消息跟发送端一样为  AAA BBB CCC

写入端写入（AAA BBB CCC），协议不保留消息边界，则接收端获取的消息可能为（AAAB BBC CC），跟写入端块不一样。



**The End-to-End Argument and Fate Sharing**

简单的说，重要的函数（错误控制，加密，传输）通常不应该在大型系统的底层实现，底层可以提供使终端工作更容易完成的能力或者提升性能，底层不应该设计的太完美。

命运共享是允许虚拟连接（例如，由TCP实现的那些）保持活动的设计原理之一，即使网络内的连接在（适度的）时间段内失败也是如此。



错误控制和流量控制

在某些情况下，网络中的数据会因为各种各样的原因损坏或者丢失。处理这些错误的方法称为错误控制，它可以在构成网络基础设施的系统中实现，或者在连接到网络中的系统中实现，或者两者的结合。事实上，根据The End-to-End Argument and Fate Sharing的架构原则，建议错误控制在更靠近应用程序端实现。

如果只是发生了很小数量字节错误，可以在网络中通过数学代码在接收到或者中转的时候检测并修复这些错误。

如果发生了比较重大的损坏，通常需要重新发送包，这对那些需要严格按顺序，无差错的传输数据的应用程序来说是好的，但是也有些程序不需要这样的能力，它们并不想为数据可靠传输付出代价（重新连接，转播延迟）。即使是可靠的文件传输系统也不关心数据传输的顺序，它们只关心是否所有的块都无误的传输，并能重新组装为原来的样子。

作为在网络内实现可靠的，有序的传输实现的替代方案，帧中继（Frame Relay）和互联网协议采用了一种称为尽力传递（best-effort delivery）的不同类型的服务。在尽力传递中，网络不会花费精力来保证数据的准确性，它只会检测特定的错误，在检测到数据错误之后将数据丢弃而不做进一步的行动。

尽力传递一旦成功，发送方能力超过接收方处理能力的速度生成信息。在尽力传递的IP网络中，通过在网络外部和通信系统的更高级别操作的流控制机制来实现减慢发送器的速度

## 设计和实现

通常提到的协议分层是基于国际标准化组织定义的Open Systems Interconnection（OSI），它规定了7层协议，但是TCP/IP使用了五层，虽然最后TCP/IP取得了成功，但是它也借鉴了许多基于OSI的协议的思路甚至整个协议套件

<table>
    <tr><th>编号</th><th>名称</th><th>描述例子</th></tr>
    <tr><td>1</td><td>应用层</td><td>指定完成某些用户初始化任务的方法。应用层协议倾向于由应用开发者设计和实现。例子包括FTP以及Skype等等</td></tr>
    <tr><td>2</td><td>表示层</td><td>指定表达应用程序的数据格式和转换规则的方法，典型的例子如字符从EBCDIC转换为ASCII码（但现在很少关心）。加密有时也有本层有关系，但也可以在其他层中</td></tr>
    <tr><td>3</td><td>会话层</td><td>specifies methods for multiple connections constituting a communication session，包括了关闭连接，重启连接，检查进度。<strong>会话表示应用程序之间正在进行的交互（例如，在Web登录会话期间“Web”与Web浏览器一起使用时），会话层协议可能提供连接启动和重新启动等功能，以及检查点（保存已完成的工作） 至今）</strong></td></tr>
    <tr><td>4</td><td>传输层</td><td>指定在统一计算机系统上运行的多个程序之间的连接或关联的方法，如果没有在别处实现，该层也可以实现可靠的传输</td></tr>
    <tr><td>5</td><td>网络层</td><td>specifies methods for communication in a multi-hop fashion across potentially different types of link networks（指定跨潜在不同类型的链路网络以多跳方式进行通信的方法）。对于分组网络，描述一个抽象的分组格式和标准地址结构.<strong>对于诸如TCP / IP的分组网络，它提供可互操作的分组格式，其可以使用不同类型的链路层网络来进行连接。该层还包括主机寻址方案和用于选择从一台机器发送到另一台机器时数据包的去向的路由算法</strong></td></tr>
    <tr><td>6</td><td>链路层</td><td>specifies methods for communication across a single link, including "media access" control protocols when multiple systems share the same media. Error detection is commonly included at this layer, along with link-layer address format（指定跨单个链路进行通信的方法，包括多个系统共享同一媒体时的“媒体访问”控制协议。 错误检测通常包括在该层，以及链路层地址格式）<strong>链路或数据链路层包括用于建立与共享相同介质的邻居的连接的那些协议和方法，当多个邻居可以访问同一个共享网络时，该网络被称为多址网络</strong></td></tr>
    <tr><td>7</td><td>物理层</td><td>Specifies connectors, data rates, and how bits are encoded on some media. Also describes low-level error detection and correction, plus frequency assignments.（）指定连接器，数据速率以及在某些介质上对位进行编码的方式。 还介绍了低级错误检测和纠正，以及频率分配。<strong>物理层定义了用于在诸如电话线或光纤电缆之类的通信介质上移动数字信息的方法,以太网和无线局域网（Wi-Fi）标准的部分内容在这里</strong>    </td></tr>
</table>

分层体系结构的主要优点之一是其执行协议多路复用的自然能力,这种多路复用形式允许多个不同的协议在同一基础设施上共存,它还允许同时使用相同协议对象（例如，连接）的多个实例，而不会混淆。
多路复用可以发生在多层上，并且在每一层使用不同种类的标识符（identifier）确定哪个协议或者信息流属于一起

当一层接收到其上层提供的PDU（Protocol Data unit）时，

